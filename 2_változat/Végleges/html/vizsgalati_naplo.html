<!DOCTYPE html>
<html lang="hu" data-bs-theme="light">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/index.css">
    <link rel="shortcut icon" href="../img/owl-47526.svg" type="image/x-icon">
    <title>MathMaster</title>

    <script>
        fetch('http://localhost:8000/api/auth/check-admin', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `${localStorage.getItem('token')}`,
            },
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log(data);
            })
            .catch(error => {
                console.error('Error:', error);
                if (error.message.includes('403') || error.message.includes('401')) {
                    window.location.href = '../index.html';
                }
            });
    </script>
</head>
<body>
    <div class="container-fluid">
        <header class="d-flex flex-wrap justify-content-center py-3">
            <div class="custom-container">
                <a href="#"
                    class="d-flex align-items-center mb-3 mb-md-0 ms-2 me-md-auto link-body-emphasis text-decoration-none">
                    <img class="pe-2 ceg-logo" src="../img/owl-47526.svg" alt="">
                    <span class="ceg-nev">MathMaster</span>
                </a>

                <ul class="nav nav-pills custom-nav">
                    <li class="nav-item"><a href="../index.html" class="nav-link" aria-current="page">
                            <span style="vertical-align: inherit;">Kezdőlap</span>
                        </a>
                    </li>
                    <li class="nav-item"><a href="./admin.html" class="nav-link">
                            <span style="vertical-align: inherit;">Beérkező üzenetek</span>
                        </a>
                    </li>
                    <li class="nav-item"><a href="#" class="nav-link active">
                            <span style="vertical-align: inherit;">Vizsgálati napló</span>
                        </a>
                    </li>
                    <li class="nav-item"><a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#admin">
                            <span style="vertical-align: inherit;">Admin felvétel</span>
                        </a>
                    </li>
                </ul>

                <div class="dropdown text-end">
                    <a href="#" class="d-block link-body-emphasis text-decoration-none me-2" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        <img src="../img/PersonCircle_Profile.svg" alt="mdo" width="32" height="32" class="rounded-circle">
                    </a>
                    <ul class="dropdown-menu text-small">
                        <li><a class="dropdown-item" href="#">
                                <span style="vertical-align: inherit;">Új feladat...</span>
                            </a>
                        </li>
                        <li><a class="dropdown-item" href="#">
                                <span style="vertical-align: inherit;">Statisztika</span>
                            </a>
                        </li>
                        <li><a class="dropdown-item" href="#">
                                <span style="vertical-align: inherit;">Beállítások</span>
                            </a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="#">
                                <span style="vertical-align: inherit;">Kijelentkezés</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </header>
    </div>

    <div class="container mt-5">
        <h2>Vizsgálati Napló</h2>

        <select id="select" onchange="auditLog(document.getElementById('select').value, 'DESC')">
            <option value="null">Szűrés kikapcsolva</option>
            <option value="Üzenet küldés!">Üzenet küldés!</option>
            <option value="Válasz üzenet!">Válasz üzenet!</option>
        </select>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th scope="col">Napló ID</th>
              <th scope="col">Felhasználónév</th>
              <th scope="col">Email</th>
              <th scope="col">Típus</th>
              <th scope="col">Megjegyzés</th>
              <th scope="col">Dátum</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    
      <script>


        document.addEventListener('DOMContentLoaded', () => {
            auditLog("null", "DESC")
        });

        function auditLog(type, order) {
            document.getElementById("tableBody").innerHTML = "";
            fetch(`http://localhost:8000/api/auditLog/vizsgalatinaplo/${type}/${order}`, {
            method: 'GET',
            headers: {
                'Authorization': localStorage.getItem('token'),
                'Content-Type': 'application/json'
            }
          })
            .then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
              }
              return response.json();
            })
            .then(data => {
              console.log(data)
              // Adatok feldolgozása és táblázat generálása
              const tableBody = document.getElementById('tableBody');
              data.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                  <th scope="row">${row.naplo_id}</th>
                  <td>${row.felhasznalonev}</td>
                  <td>${row.email}</td>
                  <td>${row.tipus}</td>
                  <td>${row.megjegyzes}</td>
                  <td>${new Date(row.datum).toLocaleString('hu-HU', { year: 'numeric', month: 'numeric', day: 'numeric', hour: 'numeric', minute: 'numeric' })}</td>
                `;
                tableBody.appendChild(tr);
              });
            })
            .catch(error => console.error('Error:', error));
        }
      </script>

</body>
</html>